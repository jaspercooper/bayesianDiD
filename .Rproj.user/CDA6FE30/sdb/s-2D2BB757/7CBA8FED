{
    "contents" : "---\ntitle: \"DiD Reading Notes\"\nauthor: \"Cooper & Kopas\"\ndate: \"February 9, 2015\"\noutput: pdf_document\n---\n\n\n\n# Bertrand et al., 2004. How much should we trust difference-in-difference estimates? \n\n*Bibtex citekey:* BERTRAND2004 \n\nSerial correlation almost always arises in DiD but is ignored by DiD \nresearchers. \n\nThe main problem: dependent variable changes over time and is serially \ncorrelated, but independent variable does not change over time. \n\n\n\n1. DiD \n\n\n# Ricardo Mora and Iliana Reggio, 2013, Treatment Effect Identification Using Alternative Parallel Assumptions\n\n*Bibtex citekey:* MORA2013 \n\nParallel paths: the key assumption of DiD, according to which\ndifferences between controls and treated are time-invariant\n- common invariant linear trends in the absence of treatment\n\nA good check for appropriateness of most basic parallel paths\nassumption:\n\n- do a pre-treatment DiD\n\n- if there are differences, then it is not so great, because\n  doing DiD implies that differing pre-treatment trends \n  become equal in the post-treatment phase, in the absence\n  of treatment\n\n- But there are other options:\n\n  - group-specific invariant linear trends that survive treatment\n  \n  - pre and post treatment group-specific trends\n\nIdentification depends greatly on: \n1. trend-modeling strategy\n2. definition of trend variable\n\nProblem with traditional DiD: when there are group-specific invariant \ntrends in outcomes (i.e. trends are not parallel), you can't identify \ndifference in outcomes\n\n\nThe key innovation of this paper is to look at the DiD of first differences\n(i.e. the effect of $\\Delta x_{it}$ on $\\Delta y_{it}$), as opposed to \nthe DiD of outcomes (effect of $x_{it}$ on $y_{it}$).\n\n- this changes the assumption to *parallel growths*\n\n- the effect of treatment *one period after treatment* is identified\n  by a difference-in-double-differences operator\n\n- key advantage: not only is parallel growths equivalent to parallel paths\n  under common pre-treatment trends, but when there are group-specific \n  trends in the post-treatment period that don't relate to treatment, \n  parallel growths assumption can still identify the causal effect\n\n  \n````{r}\n\n# True effect of treatment on outcomes = 1\n# True effect of treatment on growth = 0\n\ntest.data <- data.frame(\n     group = c(rep(\"A\",4),rep(\"B\",4)),\n     period = rep(rep(c(\"pre\",\"pos\"),c(2,2)),2),\n     Y.par.path = c(1,2,3,4, # <- here there is parallel trends \n                    2,3,5,6),\n     Y.par.grow = c(1,2,3,4, # <- here the growth is parallel, but B grows faster\n                    2,4,7,9),\n     time = rep(1:4,2)     \n     )\n\n# Traditional parallel paths DiD where assumption holds:\nwith(test.data,{\n     (mean(Y.par.path[group == \"B\"&period == \"pos\"]) - \n          mean(Y.par.path[group == \"B\"&period == \"pre\"])) -\n               (mean(Y.par.path[group == \"A\"&period == \"pos\"]) - \n                    mean(Y.par.path[group == \"A\"&period == \"pre\"])) \n})\n\n# Traditional parallel paths DiD where assumption does not hold:\nwith(test.data,{\n     (mean(Y.par.grow[group == \"B\"&period == \"pos\"]) - \n          mean(Y.par.grow[group == \"B\"&period == \"pre\"])) -\n               (mean(Y.par.grow[group == \"A\"&period == \"pos\"]) - \n                    mean(Y.par.grow[group == \"A\"&period == \"pre\"])) \n})\n\n# Parallel growths DiD where assumption holds:\nwith(test.data,{\n     (\n          (Y.par.path[group == \"B\"&period == \"pos\"&time == 4] - \n                Y.par.path[group == \"B\"&period == \"pos\"&time == 3]\n           ) - \n               (Y.par.path[group == \"B\"&period == \"pre\"&time == 2] - \n                     Y.par.path[group == \"B\"&period == \"pre\"&time == 1] \n                )\n     ) -\n          (\n          (Y.par.path[group == \"A\"&period == \"pos\"&time == 4] - \n                Y.par.path[group == \"A\"&period == \"pos\"&time == 3]\n           ) - \n               (Y.par.path[group == \"A\"&period == \"pre\"&time == 2] - \n                     Y.par.path[group == \"A\"&period == \"pre\"&time == 1] \n                )\n     )\n})\n\n# Parallel growths DiD where assumption does not hold:\nwith(test.data,{\n     (\n          (Y.par.grow[group == \"B\"&period == \"pos\"&time == 4] - \n                Y.par.grow[group == \"B\"&period == \"pos\"&time == 3]\n           ) - \n               (Y.par.grow[group == \"B\"&period == \"pre\"&time == 2] - \n                     Y.par.grow[group == \"B\"&period == \"pre\"&time == 1] \n                )\n     ) -\n          (\n          (Y.par.grow[group == \"A\"&period == \"pos\"&time == 4] - \n                Y.par.grow[group == \"A\"&period == \"pos\"&time == 3]\n           ) - \n               (Y.par.grow[group == \"A\"&period == \"pre\"&time == 2] - \n                     Y.par.grow[group == \"A\"&period == \"pre\"&time == 1] \n                )\n     )\n})\n\n# I don't see how any of these recover the difference in outcomes. \n# The parallel growths assumption only recovers the difference in growths, \n# but if there is an `intercept' effect but no slope effect, the first\n# method over estimates it while the second underestimates it.\n\n````\n\n\nSo does this mean we need to target acceleration effects?\n\n- i.e. with the wage reform DiD, does this mean that we are asking \n  whether the police started to take more, more quickly?\n\n- maybe we simply need to control for acceleration, assume pre-treatment \n  growth trends are parallel, and then we can identify both the \n  outcomes and the growth treatment effects?\n  \n*Additive Regression*\n\n- the authors contribute an additive regression model, which basically \n  considers multiple relationships of the X's to Y, and adds them together\n  \n\n*Consider dropping June and July from the analysis?*\n\n- In general we consider that treatment starts some time after the last\n  pre-treatment period ($t^*$) and ends some time before the first post-\n  treatment period ($t^*+1$). \n\n- So the way to get around knowing exactly when the treatment took effect\n  is to extend beyond June and July \n\n- of course, robustness checks would be necessary, but can be put in an \n  appendix\n  \nNotation:\n\n- $T_0$ defines number of pre-treatment periods\n\n- $S$ defines number of post-treatment periods\n\n- $Y_t^0$ is outcome at $t$ when subject does not receive treatment, \n  $Y_t^1$ is outcome when subject receives treatment \n\n- $D = 1$ if subject receives treatment, $0$ if not\n\n- for pre-treatment periods, $Y_t = Y_t^0$. \n\n- the study thus looks at the conditions for identifying: \n  $$ \\alpha(s|X) = E[Y_{t^*+s}^1-Y_{t^*+s}^0 | X, D = 1]$$\n  i.e. the average treatment effect among the treated, $s \\leq S$ periods \n  after treatment has taken place\n\nThe fundamental problem of causal inference applied to this scenario is that\nwe cannot observe $Y_{t^*+s}^0$ for subjects for whom $D = 1$. To isolate \n$\\alpha(s|X)$ thus requires that we make inferences about $Y_{t^*+s}^0$\nbased on what happens to subjects for whom $D = 0$. \n\n*Lag operator*:\n\nThe lag operator $L$ takes the difference between the current and some previous\ntime period.\n\nSo, for example:\n\n- $LX_t = X_{t-1}$ and $X_t = LX_{t+1}$\n\nThen, we can use this operator to define changes in some $X$:\n\n- $\\Delta X_t = X_t - X_{t-1}$\n- $\\Delta X_t = (1 - L)X_t = X_t - X_{t-1}$\n\nYou can also get the second-difference operator (i.e. growth-in-growth, \nacceleration) by exponentializing the $L$ operator: \n\n- $\\Delta (\\Delta X_t) = \\Delta X_t - \\Delta X_{t-1}$\n- $\\Delta^2 X_t = (1-L)\\Delta X_t = (1 - L)(1 - L)X_t = (1 - L)^2 X_t$\n\nIn the Mora and Reggio article, they use $\\Delta_s = (1-L^s)$, so that \n$\\Delta_s$ tells you the difference in outcomes over $s$ periods. \n\n\n###Formal Definition of Parallel Paths:\n\n\n\n$$E[\\Delta_s Y_{t^*+s}^0 | X, D = 1] = E[\\Delta_s Y_{t^* + s}^0 | X, D = 0]$$\n\n*and* \n\n$$E[Y_{t^*+s}^0 | X, D = 1] = \nE[Y_{t^*} | X, D = 1] + \nE[\\Delta_s Y_{t^*+s}^0 | X, D = 0]$$\n\n- in other words, if untreated, those who received treatment would have an \n  outcome equivalent to their outcome in the last pre-treatment period, \n  plus whatever change took place in the $s$ periods among those who did not \n  receive treatment \n\n- this is quite different from the conditional ignorability of experimental \n  inference, because it requires only that the *change* remain constant \n  in the absence of treatment \n     - in other words, the outcomes don't have to be equal in expectation, as \n       in classical inference, just the trends that define the outcomes \n  \n- this is a good argument for including lots of time-level covariates\n\n- what do time-level FE do here? i.e. if we think that each period \n  has independent time effects? \n  \n     - there definitely might be scope for writing this up as a Bayesian model\n       with time-level effects \n\n\n*DiD* with parallel paths is a special case of the $s$-period operator, in \nwhich there is just 1 period: \n\n$$ \\alpha(1|X) = E[\\Delta Y_{t^* +1} | X, D = 1] - \nE[\\Delta Y_{t^* +1} | X, D = 0]$$\n\n\n# Kay H. Brodersen et al., 2014, Inferring Causal Impact Using Bayesian Structural Time-Series Models\n\n*Bibtex citekey:* BRODERSON2014\n\nTechnique aims to:\n\n- provide a fully Bayesian time-series estimate for the causal effect\n\n- construct the most appropriate synthetic control for modelling the \n  counterfactual\n  \nIncorporates three forms of data in order to estimate DiD:\n\n1. the time-series behaviour of the response itself, prior to the intervention\n\n2. the behaviour of other time series that were predictive of the target series \n   prior to the intervention.\n   \n3. a third source of information for inferring the counterfactual is the \n   available prior knowledge about the model parameters\n\nLike any other DiD, we are assuming some kind of stationarity in the difference\nbetween treated and untreated\n\n## Method:\n\n- We compute the posterior distribution of the counterfactual time series given \n  the value of the target series in the pre-intervention period, \n  along with the values of the controls in the post-intervention period. \n  Subtracting the predicted from the observed response during the \n  post-intervention period gives a semiparametric Bayesian posterior \n  distribution for the causal effect\n\nIt's genius: the pre-treatment period is used to construct a model for \npredicting $Y_0 | D = 1$, then the post-treatment data of $Y_0 | D = 0$ \nis used to predict $Y_0 | D = 1$ post-treatment, and the effect is \ncalculated as the difference between that prediction and the actual \nvalues. It's a much more robust and flexible form of traditional DiD. \n\n\n## Difference with previous studies:\n\n*Gets around autocorellation pointed to by BertDufMull 2004*:\n\n- \"First, DD is traditionally based on a static regression model that assumes i.i.d. \n  data despite the fact that the design has a temporal component. When fit to \n  serially correlated data, static models yield overoptimistic inferences with \n  too narrow uncertainty intervals \n  (see also Solon, 1984; Hansen, 2007a,b; Bertrand, Duflo and Mullainathan, \n  2002).\n\n*Leverages multiple time points*\n\n- \"Second, most DD analyses only consider two time points: before and after the \n  intervention. In practice, the manner in which an effect evolves over time, \n  especially its onset and decay structure, is often a key question.\"\n\n*Does not rely on crappy paramaterizations of time-trends*\n\n- \"Third, when DD analyses are based on time series, previous studies have \n   imposed restrictions on the way in which a synthetic control is constructed \n   from a set of predictor variables.\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1445619664045.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "261997102",
    "id" : "7CBA8FED",
    "lastKnownWriteTime" : 1445599461,
    "path" : "~/Dropbox/07 Methods/03_DiD/01_DiD Notes.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_markdown"
}